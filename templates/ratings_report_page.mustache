{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template local_datacurso_ratings/ratings_report_page

    TODO describe template report_ratings_course

    Example context (json):
    {
    }
}}

{{#has_data}}
<!-- Global Summary Statistics -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-primary">
           <div class="card-header bg-primary text-white">
                <h5 class="mb-0 text-white">{{#str}} globalReportSummary, local_datacurso_ratings {{/str}}</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="pe-3 border-end">
                            <h3 class="mb-0" style="color: var(--primary);">{{summary.total_courses}}</h3>
                            <small class="text-muted">{{#str}} totalCourses, local_datacurso_ratings {{/str}}</small>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="pe-3 border-end">
                            <h3 class="mb-0" style="color: var(--info);">{{summary.total_activities}}</h3>
                            <small class="text-muted">{{#str}} totalActivities, local_datacurso_ratings {{/str}}</small>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="border-end">
                            <h3 class="text-secondary mb-0">{{summary.activities_with_ratings}}</h3>
                            <small class="text-muted">{{#str}} ratedActivities, local_datacurso_ratings {{/str}}</small>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <h3 class="mb-0" style="color: var(--success);">{{summary.total_likes}}</h3>
                        <small class="text-muted">üëç {{#str}} likes, local_datacurso_ratings {{/str}}</small>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <h3 class="mb-0" style="color: var(--danger);">{{summary.total_dislikes}}</h3>
                        <small class="text-muted">üëé {{#str}} dislikes, local_datacurso_ratings {{/str}}</small>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <h3 class="mb-0 text-{{summary.satisfaction_class}}">{{summary.overall_satisfaction}}%</h3>
                        <small class="text-muted">{{#str}} globalSatisfaction, local_datacurso_ratings {{/str}}</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- AI analysis of comments -->
<div class="mb-3 mt-3">
    <button  
        class="btn btn-outline-secondary btn-generate-ai">
        {{#str}} generatecommentaiglobal, local_datacurso_ratings {{/str}} ‚ú®
    </button>
    <div class="ai-analysis-result-global mt-2"></div>
</div>

<!-- Filters -->
<div class="row mb-3">
    <div class="col-md-6">
        <div class="input-group">
            <span class="input-group-text"><i class="fa fa-search"></i></span>
            <input type="text" class="form-control" id="activity-search"
                placeholder="{{#str}} searchActivities, local_datacurso_ratings {{/str}}">
        </div>
    </div>

    <!-- Category filter con datalist -->
    <div class="col-md-3">
        <input list="categories" class="form-control" id="category-filter" 
               placeholder="Buscar categor√≠a..." data-category-id="">
        <datalist id="categories">
            <option value="Todas las categor√≠as" data-id="">Todas las categor√≠as</option>
            {{#categories}}
            <option value="{{name}}" data-id="{{id}}">{{name}}</option>
            {{/categories}}
        </datalist>
    </div>
    
    <!-- Course filter con datalist -->
    <div class="col-md-3">
        <input list="courses" class="form-control" id="course-filter" 
               placeholder="Buscar curso...">
        <datalist id="courses">
            <option value="Todos los cursos">Todos los cursos</option>
        </datalist>
    </div>
</div>

<!-- Courses Sections -->
{{#courses}}
<div class="course-section mb-4" data-course="{{courseName}}" data-category="{{categoryid}}">
    <div class="card">
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <h5 class="mb-0">{{courseName}}</h5>
                </div>
                <div class="d-flex align-items-center gap-7">
                    <b class="text-dark mr-3">{{courseActivities}} {{#str}} activities, local_datacurso_ratings {{/str}}</b>
                    <span class="mr-3">{{courseLikes}} üëç</span>
                    <span class="mr-3">{{courseDislikes}} üëé</span>
                    <span class="badge bg-{{courseSatisfactionClass}} fs-6 text-light">{{courseSatisfaction}}%</span>
                </div>
            </div>
        </div>
        
        <div class="collapse show" id="course-{{@index}}">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table mb-0">
                         <thead>
                            <tr>
                                <th data-sort="actividad">{{#str}} activity, local_datacurso_ratings {{/str}}</th>
                                <th data-sort="total_ratings" class="text-center">{{#str}} totalRatings, local_datacurso_ratings {{/str}}</th>
                                <th data-sort="likes" class="text-center">üëç {{#str}} likes, local_datacurso_ratings {{/str}}</th>
                                <th data-sort="dislikes" class="text-center">üëé {{#str}} dislikes, local_datacurso_ratings {{/str}}</th>
                                <th data-sort="porcentaje" class="text-center">{{#str}} satisfaction, local_datacurso_ratings {{/str}}</th>
                                <th class="text-center">{{#str}} comments, local_datacurso_ratings {{/str}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#activities}}
                            <tr class="activity-row" data-activity="{{activity}}" {{^has_ratings}}style="opacity: 0.7;"{{/has_ratings}}>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <strong>
                                        <a href="{{url}}" target="_blank" title="{{#str}} viewActivity, local_datacurso_ratings {{/str}}">
                                            {{activity}}
                                        </a>
                                        </strong>
                                        {{^has_ratings}}
                                        <span class="badge bg-secondary ms-2 small">{{#str}} noRatings, local_datacurso_ratings {{/str}}</span>
                                        {{/has_ratings}}
                                    </div>
                                </td>
                                <td class="text-center">
                                    <span>{{total_ratings}}</span>
                                </td>
                                <td class="text-center">
                                    {{#has_ratings}}
                                    <span class="text-success fw-bold fs-5">{{likes}}</span>
                                    {{/has_ratings}}
                                    {{^has_ratings}}
                                    <span class="text-muted">0</span>
                                    {{/has_ratings}}
                                </td>
                                <td class="text-center">
                                    {{#has_ratings}}
                                    <span class="text-danger fw-bold fs-5">{{dislikes}}</span>
                                    {{/has_ratings}}
                                    {{^has_ratings}}
                                    <span class="text-muted">0</span>
                                    {{/has_ratings}}
                                </td>
                                <td class="text-center">
                                    {{#has_ratings}}
                                    <span>{{formatted_percentage}}</span>
                                    {{/has_ratings}}
                                    {{^has_ratings}}
                                    <span class="text-muted">N/A</span>
                                    {{/has_ratings}}
                                </td>
                                <!-- Comments modal -->
                                <td class="text-center">
                                    {{#has_comments}}
                                    <button type="button" 
                                            class="btn btn-sm btn-outline-info view-comments-modal"
                                            data-cmid="{{cmid}}"
                                            data-activity="{{activity}}">
                                        {{#str}} viewComments, local_datacurso_ratings {{/str}}
                                    </button>
                                    {{/has_comments}}
                                    {{^has_comments}}
                                    <span class="text-muted">{{#str}} noComments, local_datacurso_ratings {{/str}}</span>
                                    {{/has_comments}}
                                </td>
                            </tr>
                            {{/activities}}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{{/courses}}

{{/has_data}}

{{^has_data}}
<!-- No Data Message -->
<div class="text-center py-5">
    <div class="mb-4">
        <i class="fa fa-chart-bar fa-4x text-muted"></i>
    </div>
    <h3 class="text-muted">{{#str}} noGlobalDataAvailable, local_datacurso_ratings {{/str}}</h3>
    <p class="text-muted mb-4">{{#str}} noGlobalDataDescription, local_datacurso_ratings {{/str}}</p>
    <div class="alert alert-info">
        <h5>{{#str}} getStarted, local_datacurso_ratings {{/str}}</h5>
        <p class="mb-0">{{#str}} getStartedDescription, local_datacurso_ratings {{/str}}</p>
    </div>
    <div class="mt-4">
        <button class="btn btn-primary" onclick="location.reload()">
            <i class="fa fa-refresh"></i> {{#str}} refresh, local_datacurso_ratings {{/str}}
        </button>
    </div>
</div>
{{/has_data}}
