{"version":3,"file":"rate.min.js","sources":["../src/rate.js"],"sourcesContent":["/* eslint-disable */\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport {get_string as getString} from 'core/str';\n\n/**\n * Initialise rating widget for the given cmid.\n * @param {Number} cmid\n */\nexport const init = (cmid) => {\n    const container = document.querySelector(`.local-dcr-rate[data-cmid=\"${cmid}\"]`);\n    if (!container) {\n        return;\n    }\n\n    const fbBlock = container.querySelector('.local-dcr-feedback');\n    const fbInput = container.querySelector('#local-dcr-feedback-input');\n    const fbTextareaWrap = container.querySelector('#local-dcr-feedback-textarea');\n    const sendBtn = container.querySelector('[data-action=\"send\"]');\n    const cancelBtn = container.querySelector('[data-action=\"cancel\"]');\n\n    const show = el => { if (el) { el.style.display = 'block'; el.setAttribute('aria-hidden', 'false'); } };\n    const hide = el => { if (el) { el.style.display = 'none'; el.setAttribute('aria-hidden', 'true'); } };\n\n    // Eventos para rate ðŸ‘ y ðŸ‘Ž\n    container.querySelectorAll('[data-action=\"rate\"]').forEach(btn => {\n        btn.addEventListener('click', () => {\n            const rating = parseInt(btn.dataset.rating, 10);\n            if (rating === 0) {\n                // Dislike â†’ mostrar bloque de feedback\n                show(fbBlock);\n                sendBtn?.setAttribute('data-rating', '0');\n            } else {\n                // Like â†’ guardar directo\n                sendRating(cmid, 1, '');\n            }\n        });\n    });\n\n    // Mostrar textarea solo si selecciona \"Otras\"\n    container.querySelectorAll('input[name=\"feedback_choice\"]').forEach(radio => {\n        radio.addEventListener('change', () => {\n            if (radio.value === 'other' && radio.checked) {\n                show(fbTextareaWrap);\n                fbInput?.focus();\n            } else if (radio.checked) {\n                hide(fbTextareaWrap);\n            }\n        });\n    });\n\n    // Cancelar feedback\n    cancelBtn?.addEventListener('click', () => {\n        hide(fbBlock);\n        hide(fbTextareaWrap);\n        if (fbInput) fbInput.value = '';\n        container.querySelectorAll('input[name=\"feedback_choice\"]').forEach(r => r.checked = false);\n    });\n\n    // Enviar feedback\n    sendBtn?.addEventListener('click', () => {\n        const rating = parseInt(sendBtn.getAttribute('data-rating') || '0', 10);\n        const selected = container.querySelector('input[name=\"feedback_choice\"]:checked');\n\n        let feedback = '';\n        if (selected) {\n            if (selected.value === 'other') {\n                feedback = (fbInput?.value || '').trim();\n            } else {\n                feedback = selected.value;\n            }\n        }\n\n        sendRating(cmid, rating, feedback);\n    });\n\n    function sendRating(cmid, rating, feedback) {\n        Ajax.call([{\n            methodname: 'local_datacurso_ratings_save_rating',\n            args: {cmid, rating, feedback}\n        }])[0]\n        .then(async() => {\n            const saved = await getString('ratingsaved', 'local_datacurso_ratings');\n            Notification.addNotification({message: saved, type: 'success'});\n\n            // Deshabilitar botones despuÃ©s de enviar\n            if (container) {\n                container.querySelectorAll('[data-action=\"rate\"]').forEach(btn => btn.disabled = true);\n                container.querySelectorAll('input[name=\"feedback_choice\"]').forEach(r => r.disabled = true);\n                if (sendBtn) sendBtn.disabled = true;\n            }\n\n            hide(fbBlock);\n            hide(fbTextareaWrap);\n        })\n        .catch(Notification.exception);\n    }\n};\n\nexport default {init};"],"names":["init","cmid","container","document","querySelector","fbBlock","fbInput","fbTextareaWrap","sendBtn","cancelBtn","show","el","style","display","setAttribute","hide","sendRating","rating","feedback","call","methodname","args","then","async","saved","addNotification","message","type","querySelectorAll","forEach","btn","disabled","r","catch","Notification","exception","addEventListener","parseInt","dataset","radio","value","checked","focus","getAttribute","selected","trim"],"mappings":"wZASaA,KAAQC,aACXC,UAAYC,SAASC,mDAA4CH,gBAClEC,uBAICG,QAAUH,UAAUE,cAAc,uBAClCE,QAAUJ,UAAUE,cAAc,6BAClCG,eAAiBL,UAAUE,cAAc,gCACzCI,QAAUN,UAAUE,cAAc,wBAClCK,UAAYP,UAAUE,cAAc,0BAEpCM,KAAOC,KAAYA,KAAMA,GAAGC,MAAMC,QAAU,QAASF,GAAGG,aAAa,cAAe,WACpFC,KAAOJ,KAAYA,KAAMA,GAAGC,MAAMC,QAAU,OAAQF,GAAGG,aAAa,cAAe,mBAsDhFE,WAAWf,KAAMgB,OAAQC,wBACzBC,KAAK,CAAC,CACPC,WAAY,sCACZC,KAAM,CAACpB,KAAAA,KAAMgB,OAAAA,OAAQC,SAAAA,aACrB,GACHI,MAAKC,gBACIC,YAAc,mBAAU,cAAe,iDAChCC,gBAAgB,CAACC,QAASF,MAAOG,KAAM,YAGhDzB,YACAA,UAAU0B,iBAAiB,wBAAwBC,SAAQC,KAAOA,IAAIC,UAAW,IACjF7B,UAAU0B,iBAAiB,iCAAiCC,SAAQG,GAAKA,EAAED,UAAW,IAClFvB,UAASA,QAAQuB,UAAW,IAGpChB,KAAKV,SACLU,KAAKR,mBAER0B,MAAMC,sBAAaC,WAtExBjC,UAAU0B,iBAAiB,wBAAwBC,SAAQC,MACvDA,IAAIM,iBAAiB,SAAS,KAEX,IADAC,SAASP,IAAIQ,QAAQrB,OAAQ,KAGxCP,KAAKL,SACLG,MAAAA,SAAAA,QAASM,aAAa,cAAe,MAGrCE,WAAWf,KAAM,EAAG,UAMhCC,UAAU0B,iBAAiB,iCAAiCC,SAAQU,QAChEA,MAAMH,iBAAiB,UAAU,KACT,UAAhBG,MAAMC,OAAqBD,MAAME,SACjC/B,KAAKH,gBACLD,MAAAA,SAAAA,QAASoC,SACFH,MAAME,SACb1B,KAAKR,sBAMjBE,MAAAA,WAAAA,UAAW2B,iBAAiB,SAAS,KACjCrB,KAAKV,SACLU,KAAKR,gBACDD,UAASA,QAAQkC,MAAQ,IAC7BtC,UAAU0B,iBAAiB,iCAAiCC,SAAQG,GAAKA,EAAES,SAAU,OAIzFjC,MAAAA,SAAAA,QAAS4B,iBAAiB,SAAS,WACzBnB,OAASoB,SAAS7B,QAAQmC,aAAa,gBAAkB,IAAK,IAC9DC,SAAW1C,UAAUE,cAAc,6CAErCc,SAAW,GACX0B,WAEI1B,SADmB,UAAnB0B,SAASJ,QACGlC,MAAAA,eAAAA,QAASkC,QAAS,IAAIK,OAEvBD,SAASJ,OAI5BxB,WAAWf,KAAMgB,OAAQC,8CA0BlB,CAAClB,KAAAA"}