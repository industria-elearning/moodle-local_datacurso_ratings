{"version":3,"file":"rate.min.js","sources":["../src/rate.js"],"sourcesContent":["/* eslint-disable */\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport {get_string as getString} from 'core/str';\n\n/**\n * Initialise rating widget for the given cmid.\n * @param {Number} cmid\n */\nexport const init = (cmid) => {\n    const container = document.querySelector(`.local-dcr-rate[data-cmid=\"${cmid}\"]`);\n    if (!container) {\n        return;\n    }\n\n    const openBtn = container.querySelector('[data-action=\"open-rating\"]');\n    const panel = container.querySelector('.local-dcr-panel');\n    const fbBlock = container.querySelector('.local-dcr-feedback');\n    const fbInput = container.querySelector('#local-dcr-feedback-input');\n    const sendBtn = container.querySelector('[data-action=\"send\"]');\n    const cancelBtn = container.querySelector('[data-action=\"cancel\"]');\n\n    const show = el => { if (el) { el.style.display = 'block'; el.setAttribute('aria-hidden', 'false'); } };\n    const hide = el => { if (el) { el.style.display = 'none'; el.setAttribute('aria-hidden', 'true'); } };\n\n    openBtn?.addEventListener('click', () => {\n        if (panel.style.display === 'none' || panel.getAttribute('aria-hidden') === 'true') {\n            show(panel);\n            hide(fbBlock);\n            if (fbInput) fbInput.value = ''; \n        } else {\n            hide(panel);\n            hide(fbBlock);\n            if (fbInput) fbInput.value = '';\n        }\n    });\n\n    container.querySelectorAll('[data-action=\"rate\"]').forEach(btn => {\n        btn.addEventListener('click', () => {\n            const rating = parseInt(btn.dataset.rating, 10);\n            if (rating === 0) {\n                show(fbBlock);\n                fbInput?.focus();\n                // Wait for user to submit feedback.\n                sendBtn?.setAttribute('data-rating', '0');\n            } else {\n                // Positive rating straight away.\n                sendRating(cmid, 1, '');\n            }\n        });\n    });\n\n    cancelBtn?.addEventListener('click', () => {\n        hide(fbBlock);\n        hide(panel);\n        if (fbInput) fbInput.value = '';\n    });\n\n    sendBtn?.addEventListener('click', () => {\n        const rating = parseInt(sendBtn.getAttribute('data-rating') || '0', 10);\n        const feedback = (fbInput?.value || '').trim();\n        sendRating(cmid, rating, feedback);\n    });\n\n    function sendRating(cmid, rating, feedback) {\n        Ajax.call([{\n            methodname: 'local_datacurso_ratings_save_rating',\n            args: {cmid, rating, feedback}\n        }])[0]\n        .then(async() => {\n            const thanks = await getString('ratedthanks', 'local_datacurso_ratings');\n            const saved = await getString('ratingsaved', 'local_datacurso_ratings');\n            Notification.addNotification({message: saved, type: 'success'});\n            hide(panel);\n            if (openBtn) {\n                openBtn.disabled = true;\n                openBtn.textContent = thanks; \n            }\n        })\n        .catch(Notification.exception);\n    }\n};\n\nexport default {init};\n"],"names":["init","cmid","container","document","querySelector","openBtn","panel","fbBlock","fbInput","sendBtn","cancelBtn","show","el","style","display","setAttribute","hide","sendRating","rating","feedback","call","methodname","args","then","async","thanks","saved","addNotification","message","type","disabled","textContent","catch","Notification","exception","addEventListener","getAttribute","value","querySelectorAll","forEach","btn","parseInt","dataset","focus","trim"],"mappings":"wZASaA,KAAQC,aACXC,UAAYC,SAASC,mDAA4CH,gBAClEC,uBAICG,QAAUH,UAAUE,cAAc,+BAClCE,MAAQJ,UAAUE,cAAc,oBAChCG,QAAUL,UAAUE,cAAc,uBAClCI,QAAUN,UAAUE,cAAc,6BAClCK,QAAUP,UAAUE,cAAc,wBAClCM,UAAYR,UAAUE,cAAc,0BAEpCO,KAAOC,KAAYA,KAAMA,GAAGC,MAAMC,QAAU,QAASF,GAAGG,aAAa,cAAe,WACpFC,KAAOJ,KAAYA,KAAMA,GAAGC,MAAMC,QAAU,OAAQF,GAAGG,aAAa,cAAe,mBAyChFE,WAAWhB,KAAMiB,OAAQC,wBACzBC,KAAK,CAAC,CACPC,WAAY,sCACZC,KAAM,CAACrB,KAAAA,KAAMiB,OAAAA,OAAQC,SAAAA,aACrB,GACHI,MAAKC,gBACIC,aAAe,mBAAU,cAAe,2BACxCC,YAAc,mBAAU,cAAe,iDAChCC,gBAAgB,CAACC,QAASF,MAAOG,KAAM,YACpDb,KAAKV,OACDD,UACAA,QAAQyB,UAAW,EACnBzB,QAAQ0B,YAAcN,WAG7BO,MAAMC,sBAAaC,WAtDxB7B,MAAAA,SAAAA,QAAS8B,iBAAiB,SAAS,KACH,SAAxB7B,MAAMO,MAAMC,SAA4D,SAAtCR,MAAM8B,aAAa,gBACrDzB,KAAKL,OACLU,KAAKT,SACDC,UAASA,QAAQ6B,MAAQ,MAE7BrB,KAAKV,OACLU,KAAKT,SACDC,UAASA,QAAQ6B,MAAQ,QAIrCnC,UAAUoC,iBAAiB,wBAAwBC,SAAQC,MACvDA,IAAIL,iBAAiB,SAAS,KAEX,IADAM,SAASD,IAAIE,QAAQxB,OAAQ,KAExCP,KAAKJ,SACLC,MAAAA,SAAAA,QAASmC,QAETlC,MAAAA,SAAAA,QAASM,aAAa,cAAe,MAGrCE,WAAWhB,KAAM,EAAG,UAKhCS,MAAAA,WAAAA,UAAWyB,iBAAiB,SAAS,KACjCnB,KAAKT,SACLS,KAAKV,OACDE,UAASA,QAAQ6B,MAAQ,OAGjC5B,MAAAA,SAAAA,QAAS0B,iBAAiB,SAAS,WACzBjB,OAASuB,SAAShC,QAAQ2B,aAAa,gBAAkB,IAAK,IAC9DjB,WAAYX,MAAAA,eAAAA,QAAS6B,QAAS,IAAIO,OACxC3B,WAAWhB,KAAMiB,OAAQC,8CAsBlB,CAACnB,KAAAA"}