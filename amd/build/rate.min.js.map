{"version":3,"file":"rate.min.js","sources":["../src/rate.js"],"sourcesContent":["/* eslint-disable */\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport {get_string as getString} from 'core/str';\n\n/**\n * Initialise rating widget for the given cmid.\n * @param {Number} cmid\n */\nexport const init = (cmid) => {\n    const container = document.querySelector(`.local-dcr-rate[data-cmid=\"${cmid}\"]`);\n    if (!container) {\n        return;\n    }\n\n    const fbBlock = container.querySelector('.local-dcr-feedback');\n    const fbInput = container.querySelector('#local-dcr-feedback-input');\n    const fbTextareaWrap = container.querySelector('#local-dcr-feedback-textarea');\n    const sendBtn = container.querySelector('[data-action=\"send\"]');\n    const cancelBtn = container.querySelector('[data-action=\"cancel\"]');\n    const likeOptions = container.querySelector('.like-options');\n    const dislikeOptions = container.querySelector('.dislike-options');\n\n    const show = el => { \n        if (el) { \n            el.style.display = 'block'; \n            el.setAttribute('aria-hidden', 'false'); \n        } \n    };\n    const hide = el => { \n        if (el) { \n            el.style.display = 'none'; \n            el.setAttribute('aria-hidden', 'true'); \n        } \n    };\n\n    // Eventos para rate ðŸ‘ y ðŸ‘Ž\n    container.querySelectorAll('[data-action=\"rate\"]').forEach(btn => {\n        btn.addEventListener('click', () => {\n            const rating = parseInt(btn.dataset.rating, 10);\n            \n            if (rating === 0) {\n                // Dislike â†’ mostrar opciones de dislike\n                show(fbBlock);\n                show(dislikeOptions);\n                hide(likeOptions);\n                sendBtn?.setAttribute('data-rating', '0');\n            } else {\n                // Like â†’ mostrar opciones de like\n                show(fbBlock);\n                show(likeOptions);\n                hide(dislikeOptions);\n                sendBtn?.setAttribute('data-rating', '1');\n            }\n            \n            // Ocultar textarea al cambiar de rating\n            hide(fbTextareaWrap);\n        });\n    });\n\n    // Mostrar textarea especÃ­fico si selecciona \"Otras\"\n    container.querySelectorAll('input[name=\"feedback_choice\"]').forEach(radio => {\n        radio.addEventListener('change', () => {\n            if (radio.value === 'other' && radio.checked) {\n                show(fbTextareaWrap);\n                fbInput?.focus();\n            } else if (radio.checked) {\n                hide(fbTextareaWrap);\n            }\n        });\n    });\n\n    // Cancelar feedback\n    cancelBtn?.addEventListener('click', () => {\n        hide(fbBlock);\n        hide(fbTextareaWrap);\n        \n        // Limpiar todos los campos\n        if (fbInput) fbInput.value = '';\n        \n        // Desmarcar todos los radios\n        container.querySelectorAll('input[name=\"feedback_choice\"]').forEach(r => r.checked = false);\n        \n        // Remover el data-rating del botÃ³n send\n        sendBtn?.removeAttribute('data-rating');\n    });\n\n    // Enviar feedback\n    sendBtn?.addEventListener('click', () => {\n        const rating = parseInt(sendBtn.getAttribute('data-rating') || '0', 10);\n        const selected = container.querySelector('input[name=\"feedback_choice\"]:checked');\n\n        let feedback = '';\n        \n        // Para ambos casos (like y dislike)\n        if (selected) {\n            if (selected.value === 'other') {\n                feedback = (fbInput?.value || '').trim();\n            } else {\n                feedback = selected.value;\n            }\n        }\n\n        sendRating(cmid, rating, feedback);\n    });\n\n    function sendRating(cmid, rating, feedback) {\n        Ajax.call([{\n            methodname: 'local_datacurso_ratings_save_rating',\n            args: {cmid, rating, feedback}\n        }])[0]\n        .then(async() => {\n            const saved = await getString('ratingsaved', 'local_datacurso_ratings');\n            Notification.addNotification({message: saved, type: 'success'});\n\n            // Deshabilitar botones despuÃ©s de enviar\n            if (container) {\n                container.querySelectorAll('[data-action=\"rate\"]').forEach(btn => btn.disabled = true);\n                container.querySelectorAll('input[name=\"feedback_choice\"]').forEach(r => r.disabled = true);\n                if (sendBtn) sendBtn.disabled = true;\n                if (cancelBtn) cancelBtn.disabled = true;\n                if (fbInput) fbInput.disabled = true;\n            }\n\n            // Ocultar bloques de feedback\n            hide(fbBlock);\n            hide(fbTextareaWrap);\n        })\n        .catch(Notification.exception);\n    }\n};\n\nexport default {init};"],"names":["init","cmid","container","document","querySelector","fbBlock","fbInput","fbTextareaWrap","sendBtn","cancelBtn","likeOptions","dislikeOptions","show","el","style","display","setAttribute","hide","querySelectorAll","forEach","btn","addEventListener","parseInt","dataset","rating","radio","value","checked","focus","r","removeAttribute","getAttribute","selected","feedback","trim","call","methodname","args","then","async","saved","addNotification","message","type","disabled","catch","Notification","exception","sendRating"],"mappings":"wZASaA,KAAQC,aACXC,UAAYC,SAASC,mDAA4CH,gBAClEC,uBAICG,QAAUH,UAAUE,cAAc,uBAClCE,QAAUJ,UAAUE,cAAc,6BAClCG,eAAiBL,UAAUE,cAAc,gCACzCI,QAAUN,UAAUE,cAAc,wBAClCK,UAAYP,UAAUE,cAAc,0BACpCM,YAAcR,UAAUE,cAAc,iBACtCO,eAAiBT,UAAUE,cAAc,oBAEzCQ,KAAOC,KACLA,KACAA,GAAGC,MAAMC,QAAU,QACnBF,GAAGG,aAAa,cAAe,WAGjCC,KAAOJ,KACLA,KACAA,GAAGC,MAAMC,QAAU,OACnBF,GAAGG,aAAa,cAAe,UAKvCd,UAAUgB,iBAAiB,wBAAwBC,SAAQC,MACvDA,IAAIC,iBAAiB,SAAS,KAGX,IAFAC,SAASF,IAAIG,QAAQC,OAAQ,KAIxCZ,KAAKP,SACLO,KAAKD,gBACLM,KAAKP,aACLF,MAAAA,SAAAA,QAASQ,aAAa,cAAe,OAGrCJ,KAAKP,SACLO,KAAKF,aACLO,KAAKN,gBACLH,MAAAA,SAAAA,QAASQ,aAAa,cAAe,MAIzCC,KAAKV,sBAKbL,UAAUgB,iBAAiB,iCAAiCC,SAAQM,QAChEA,MAAMJ,iBAAiB,UAAU,KACT,UAAhBI,MAAMC,OAAqBD,MAAME,SACjCf,KAAKL,gBACLD,MAAAA,SAAAA,QAASsB,SACFH,MAAME,SACbV,KAAKV,sBAMjBE,MAAAA,WAAAA,UAAWY,iBAAiB,SAAS,KACjCJ,KAAKZ,SACLY,KAAKV,gBAGDD,UAASA,QAAQoB,MAAQ,IAG7BxB,UAAUgB,iBAAiB,iCAAiCC,SAAQU,GAAKA,EAAEF,SAAU,IAGrFnB,MAAAA,SAAAA,QAASsB,gBAAgB,kBAI7BtB,MAAAA,SAAAA,QAASa,iBAAiB,SAAS,WACzBG,OAASF,SAASd,QAAQuB,aAAa,gBAAkB,IAAK,IAC9DC,SAAW9B,UAAUE,cAAc,6CAErC6B,SAAW,GAGXD,WAEIC,SADmB,UAAnBD,SAASN,QACGpB,MAAAA,eAAAA,QAASoB,QAAS,IAAIQ,OAEvBF,SAASN,gBAOZzB,KAAMuB,OAAQS,wBACzBE,KAAK,CAAC,CACPC,WAAY,sCACZC,KAAM,CAACpC,KAAAA,KAAMuB,OAAAA,OAAQS,SAAAA,aACrB,GACHK,MAAKC,gBACIC,YAAc,mBAAU,cAAe,iDAChCC,gBAAgB,CAACC,QAASF,MAAOG,KAAM,YAGhDzC,YACAA,UAAUgB,iBAAiB,wBAAwBC,SAAQC,KAAOA,IAAIwB,UAAW,IACjF1C,UAAUgB,iBAAiB,iCAAiCC,SAAQU,GAAKA,EAAEe,UAAW,IAClFpC,UAASA,QAAQoC,UAAW,GAC5BnC,YAAWA,UAAUmC,UAAW,GAChCtC,UAASA,QAAQsC,UAAW,IAIpC3B,KAAKZ,SACLY,KAAKV,mBAERsC,MAAMC,sBAAaC,WAzBpBC,CAAW/C,KAAMuB,OAAQS,8CA6BlB,CAACjC,KAAAA"}