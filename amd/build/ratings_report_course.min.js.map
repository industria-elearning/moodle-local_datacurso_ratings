{"version":3,"file":"ratings_report_course.min.js","sources":["../src/ratings_report_course.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module ratings_report_course\n *\n * @module     local_datacurso_ratings/ratings_report_course\n * @copyright  2025 Industria Elearning <info@industriaelearning.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* eslint-disable */\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport { get_string as getString } from 'core/str';\n\n/**\n * Initialize the ratings report for a course\n * @param {Number} courseid\n */\nexport const init = (courseid) => {\n    const container = document.querySelector('#ratings-report-container');\n    if (!container) {\n        return;\n    }\n\n    // Show loading state\n    showLoading(container);\n\n    // Call the web service\n    Ajax.call([{\n        methodname: 'local_datacurso_ratings_get_ratings_report_course',\n        args: { courseid: courseid }\n    }])[0]\n        .then((data) => {\n            return processReportData(data, courseid);\n        })\n        .then((templateData) => {\n            return Templates.render('local_datacurso_ratings/report_ratings_course', templateData);\n        })\n        .then((html, js) => {\n            // Replace loading with actual content\n            container.innerHTML = html;\n            Templates.runTemplateJS(js);\n\n            // Initialize any additional functionality\n            initTableFeatures();\n        })\n        .catch((error) => {\n            console.error('Error loading ratings report:', error);\n            showError(container, error);\n        });\n};\n\n/**\n * Process the raw data from web service\n * @param {Array} data Raw data from web service\n * @param {Number} courseid Course ID\n * @returns {Object} Processed data for template\n */\nfunction processReportData(data, courseid) {\n    // Calculate totals\n    let totalLikes = 0;\n    let totalDislikes = 0;\n    let activitiesWithRatings = 0;\n\n    const processedActivities = data.map(activity => {\n        totalLikes += activity.likes;\n        totalDislikes += activity.dislikes;\n\n        if (activity.likes + activity.dislikes > 0) {\n            activitiesWithRatings++;\n        }\n\n        return {\n            ...activity,\n            total_ratings: activity.likes + activity.dislikes,\n            has_ratings: (activity.likes + activity.dislikes) > 0,\n            has_comments: activity.comentarios && activity.comentarios.trim() !== '',\n            satisfaction_class: getSatisfactionClass(activity.porcentaje),\n            formatted_percentage: activity.porcentaje ? activity.porcentaje.toFixed(1) + '%' : '0%',\n            activityurl: M.cfg.wwwroot + '/mod/' + activity.modulo + '/view.php?id=' + activity.cmid\n        };\n    });\n\n    const totalRatings = totalLikes + totalDislikes;\n    const overallSatisfaction = totalRatings > 0 ? ((totalLikes / totalRatings) * 100) : 0;\n\n    return {\n        courseid: courseid,\n        activities: processedActivities,\n        has_data: processedActivities.length > 0,\n        summary: {\n            total_activities: processedActivities.length,\n            activities_with_ratings: activitiesWithRatings,\n            total_ratings: totalRatings,\n            total_likes: totalLikes,\n            total_dislikes: totalDislikes,\n            overall_satisfaction: overallSatisfaction.toFixed(1),\n            satisfaction_class: getSatisfactionClass(overallSatisfaction)\n        }\n    };\n}\n\n/**\n * Get CSS class based on satisfaction percentage\n * @param {Number} percentage\n * @returns {String}\n */\nfunction getSatisfactionClass(percentage) {\n    if (percentage >= 80) return 'success';\n    if (percentage >= 60) return 'warning';\n    return 'danger';\n}\n\n/**\n * Show loading state\n * @param {Element} container\n */\nfunction showLoading(container) {\n    container.innerHTML = `\n        <div class=\"text-center p-4\">\n            <div class=\"spinner-border text-primary\" role=\"status\">\n                <span class=\"sr-only\">Loading...</span>\n            </div>\n            <p class=\"mt-2\">Cargando reporte de calificaciones...</p>\n        </div>\n    `;\n}\n\n/**\n * Show error message\n * @param {Element} container\n * @param {Object} error\n */\nfunction showError(container, error) {\n    container.innerHTML = `\n        <div class=\"alert alert-danger\">\n            <h4>Error al cargar el reporte</h4>\n            <p>No se pudo cargar la informaci√≥n del reporte. Por favor, intente nuevamente.</p>\n            <small>Error: ${error.message || 'Error desconocido'}</small>\n        </div>\n    `;\n}\n\n/**\n * Initialize additional table features (sorting, filtering, etc.)\n */\nfunction initTableFeatures() {\n    // Add click handlers for expandable comments\n    document.querySelectorAll('.expand-comments').forEach(button => {\n        button.addEventListener('click', (e) => {\n            const target = e.target.getAttribute('data-target');\n            const commentsDiv = document.querySelector(target);\n\n            if (commentsDiv.style.display === 'none' || !commentsDiv.style.display) {\n                commentsDiv.style.display = 'block';\n                e.target.textContent = 'Ocultar comentarios';\n            } else {\n                commentsDiv.style.display = 'none';\n                e.target.textContent = 'Ver comentarios';\n            }\n        });\n    });\n\n    // Add sorting functionality (optional)\n    initTableSorting();\n}\n\n/**\n * Initialize table sorting functionality\n */\nfunction initTableSorting() {\n    const headers = document.querySelectorAll('th[data-sort]');\n    headers.forEach(header => {\n        header.style.cursor = 'pointer';\n        header.addEventListener('click', () => {\n            const sortBy = header.getAttribute('data-sort');\n            sortTable(sortBy);\n        });\n    });\n}\n\n/**\n * Sort table by column\n * @param {String} column\n */\nfunction sortTable(column) {\n    // Implementation for table sorting\n    console.log('Sorting by:', column);\n    // You can implement actual sorting logic here if needed\n}\n\nexport default { init };"],"names":["init","courseid","container","document","querySelector","innerHTML","showLoading","call","methodname","args","then","data","totalLikes","totalDislikes","activitiesWithRatings","processedActivities","map","activity","likes","dislikes","total_ratings","has_ratings","has_comments","comentarios","trim","satisfaction_class","getSatisfactionClass","porcentaje","formatted_percentage","toFixed","activityurl","M","cfg","wwwroot","modulo","cmid","totalRatings","overallSatisfaction","activities","has_data","length","summary","total_activities","activities_with_ratings","total_likes","total_dislikes","overall_satisfaction","processReportData","templateData","Templates","render","html","js","runTemplateJS","querySelectorAll","forEach","button","addEventListener","e","target","getAttribute","commentsDiv","style","display","textContent","header","cursor","sortBy","column","console","log","catch","error","message","showError","percentage"],"mappings":";;;;;;;+OAiCaA,KAAQC,iBACXC,UAAYC,SAASC,cAAc,6BACpCF,sBAiGYA,WACjBA,UAAUG,mSA7FVC,CAAYJ,yBAGPK,KAAK,CAAC,CACPC,WAAY,oDACZC,KAAM,CAAER,SAAUA,aAClB,GACCS,MAAMC,eA0BYA,KAAMV,cAEzBW,WAAa,EACbC,cAAgB,EAChBC,sBAAwB,QAEtBC,oBAAsBJ,KAAKK,KAAIC,WACjCL,YAAcK,SAASC,MACvBL,eAAiBI,SAASE,SAEtBF,SAASC,MAAQD,SAASE,SAAW,GACrCL,wBAGG,IACAG,SACHG,cAAeH,SAASC,MAAQD,SAASE,SACzCE,YAAcJ,SAASC,MAAQD,SAASE,SAAY,EACpDG,aAAcL,SAASM,aAA+C,KAAhCN,SAASM,YAAYC,OAC3DC,mBAAoBC,qBAAqBT,SAASU,YAClDC,qBAAsBX,SAASU,WAAaV,SAASU,WAAWE,QAAQ,GAAK,IAAM,KACnFC,YAAaC,EAAEC,IAAIC,QAAU,QAAUhB,SAASiB,OAAS,gBAAkBjB,SAASkB,SAItFC,aAAexB,WAAaC,cAC5BwB,oBAAsBD,aAAe,EAAMxB,WAAawB,aAAgB,IAAO,QAE9E,CACHnC,SAAUA,SACVqC,WAAYvB,oBACZwB,SAAUxB,oBAAoByB,OAAS,EACvCC,QAAS,CACLC,iBAAkB3B,oBAAoByB,OACtCG,wBAAyB7B,sBACzBM,cAAegB,aACfQ,YAAahC,WACbiC,eAAgBhC,cAChBiC,qBAAsBT,oBAAoBR,QAAQ,GAClDJ,mBAAoBC,qBAAqBW,uBAhElCU,CAAkBpC,KAAMV,YAElCS,MAAMsC,cACIC,mBAAUC,OAAO,gDAAiDF,gBAE5EtC,MAAK,CAACyC,KAAMC,MAETlD,UAAUG,UAAY8C,wBACZE,cAAcD,IA2GhCjD,SAASmD,iBAAiB,oBAAoBC,SAAQC,SAClDA,OAAOC,iBAAiB,SAAUC,UACxBC,OAASD,EAAEC,OAAOC,aAAa,eAC/BC,YAAc1D,SAASC,cAAcuD,QAET,SAA9BE,YAAYC,MAAMC,SAAuBF,YAAYC,MAAMC,SAI3DF,YAAYC,MAAMC,QAAU,OAC5BL,EAAEC,OAAOK,YAAc,oBAJvBH,YAAYC,MAAMC,QAAU,QAC5BL,EAAEC,OAAOK,YAAc,6BAgBnB7D,SAASmD,iBAAiB,iBAClCC,SAAQU,SACZA,OAAOH,MAAMI,OAAS,UACtBD,OAAOR,iBAAiB,SAAS,WACvBU,OAASF,OAAOL,aAAa,iBAU5BQ,OAAAA,OATGD,OAWlBE,QAAQC,IAAI,cAAeF,iBA7ItBG,OAAOC,QACJH,QAAQG,MAAM,gCAAiCA,gBAsFxCtE,UAAWsE,OAC1BtE,UAAUG,4OAIcmE,MAAMC,SAAW,sDA1FjCC,CAAUxE,UAAWsE,qBA2DxB9C,qBAAqBiD,mBACtBA,YAAc,GAAW,UACzBA,YAAc,GAAW,UACtB,yCAiFI,CAAE3E,KAAAA"}