{"version":3,"file":"comments_modal.min.js","sources":["../src/comments_modal.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module comments_modal\n *\n * @module     local_datacurso_ratings/comments_modal\n * @copyright  2025 Industria Elearning <info@industriaelearning.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* eslint-disable */\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\n\n/**\n * Initialize comments modal functionality\n */\nexport const init = () => {\n    // Add click handlers to all \"View Comments\" buttons\n    document.addEventListener('click', function(e) {\n        if (e.target.classList.contains('view-comments-modal') || \n            e.target.closest('.view-comments-modal')) {\n            \n            e.preventDefault();\n            const button = e.target.classList.contains('view-comments-modal') ? \n                          e.target : e.target.closest('.view-comments-modal');\n            \n            const cmid = button.getAttribute('data-cmid');\n            const activityName = button.getAttribute('data-activity');\n            \n            if (cmid) {\n                openCommentsModal(cmid, activityName);\n            }\n        }\n    });\n};\n\n/**\n * Open the comments modal for a specific activity\n * @param {Number} cmid Course module ID\n * @param {String} activityName Activity name\n */\nfunction openCommentsModal(cmid, activityName) {\n    ModalFactory.create({\n        type: ModalFactory.types.DEFAULT,\n        title: 'Comentarios: ' + activityName,\n        body: '<div class=\"text-center p-4\"><div class=\"spinner-border\"></div><p>Cargando comentarios...</p></div>',\n        large: true\n    }).then(function(modal) {\n        modal.show();\n        \n        // Load comments data\n        loadCommentsData(cmid, 0, '', modal);\n        \n        // Handle modal events\n        modal.getRoot().on(ModalEvents.hidden, function() {\n            modal.destroy();\n        });\n        \n        return modal;\n    });\n}\n\n/**\n * Load comments data for the modal\n * @param {Number} cmid Course module ID\n * @param {Number} page Page number\n * @param {String} search Search text\n * @param {Object} modal Modal instance\n */\nfunction loadCommentsData(cmid, page = 0, search = '', modal) {\n    Ajax.call([{\n        methodname: 'local_datacurso_ratings_get_activity_comments',\n        args: {\n            cmid: cmid,\n            page: page,\n            perpage: 20,\n            search: search\n        }\n    }])[0]\n    .then((data) => {\n        return Templates.render('local_datacurso_ratings/comments_modal_content', {\n            ...data,\n            search_term: search\n        });\n    })\n    .then((html, js) => {\n        modal.setBody(html);\n        Templates.runTemplateJS(js);\n        \n        // Initialize modal functionality\n        initModalFeatures(cmid, modal);\n    })\n    .catch((error) => {\n        console.error('Error loading comments:', error);\n        modal.setBody('<div class=\"alert alert-danger\">Error al cargar los comentarios. Intente nuevamente.</div>');\n    });\n}\n\n/**\n * Initialize modal features (search, pagination)\n * @param {Number} cmid Course module ID\n * @param {Object} modal Modal instance\n */\nfunction initModalFeatures(cmid, modal) {\n    const modalBody = modal.getBody()[0];\n    \n    // Search functionality\n    const searchInput = modalBody.querySelector('#comments-search');\n    if (searchInput) {\n        let searchTimeout;\n        searchInput.addEventListener('input', function() {\n            clearTimeout(searchTimeout);\n            searchTimeout = setTimeout(() => {\n                const searchTerm = this.value.trim();\n                loadCommentsData(cmid, 0, searchTerm, modal);\n            }, 500); // Debounce search\n        });\n    }\n    \n    // Clear search functionality\n    const clearSearch = modalBody.querySelector('#clear-search');\n    if (clearSearch) {\n        clearSearch.addEventListener('click', function() {\n            searchInput.value = '';\n            loadCommentsData(cmid, 0, '', modal);\n        });\n    }\n    \n    // Pagination functionality\n    modalBody.addEventListener('click', function(e) {\n        if (e.target.classList.contains('comments-pagination')) {\n            e.preventDefault();\n            const page = parseInt(e.target.getAttribute('data-page'));\n            const searchTerm = searchInput ? searchInput.value.trim() : '';\n            loadCommentsData(cmid, page, searchTerm, modal);\n        }\n    });\n    \n    // Keywords click functionality\n    modalBody.addEventListener('click', function(e) {\n        if (e.target.classList.contains('keyword-filter')) {\n            e.preventDefault();\n            const keyword = e.target.textContent.trim();\n            if (searchInput) {\n                searchInput.value = keyword;\n                loadCommentsData(cmid, 0, keyword, modal);\n            }\n        }\n    });\n}\n\nexport default {init};"],"names":["init","document","addEventListener","e","target","classList","contains","closest","preventDefault","button","cmid","getAttribute","activityName","create","type","ModalFactory","types","DEFAULT","title","body","large","then","modal","show","loadCommentsData","getRoot","on","ModalEvents","hidden","destroy","openCommentsModal","page","search","call","methodname","args","perpage","data","Templates","render","search_term","html","js","setBody","runTemplateJS","initModalFeatures","catch","error","console","modalBody","getBody","searchInput","querySelector","searchTimeout","clearTimeout","setTimeout","searchTerm","this","value","trim","clearSearch","parseInt","keyword","textContent"],"mappings":";;;;;;;qSAgCaA,KAAO,KAEhBC,SAASC,iBAAiB,SAAS,SAASC,MACpCA,EAAEC,OAAOC,UAAUC,SAAS,wBAC5BH,EAAEC,OAAOG,QAAQ,wBAAyB,CAE1CJ,EAAEK,uBACIC,OAASN,EAAEC,OAAOC,UAAUC,SAAS,uBAC7BH,EAAEC,OAASD,EAAEC,OAAOG,QAAQ,wBAEpCG,KAAOD,OAAOE,aAAa,aAC3BC,aAAeH,OAAOE,aAAa,iBAErCD,eAYWA,KAAME,qCAChBC,OAAO,CAChBC,KAAMC,uBAAaC,MAAMC,QACzBC,MAAO,gBAAkBN,aACzBO,KAAM,sGACNC,OAAO,IACRC,MAAK,SAASC,cACbA,MAAMC,OAGNC,iBAAiBd,KAAM,EAAG,GAAIY,OAG9BA,MAAMG,UAAUC,GAAGC,sBAAYC,QAAQ,WACnCN,MAAMO,aAGHP,SA5BCQ,CAAkBpB,KAAME,4BAuC/BY,iBAAiBd,UAAMqB,4DAAO,EAAGC,8DAAS,GAAIV,2DAC9CW,KAAK,CAAC,CACPC,WAAY,gDACZC,KAAM,CACFzB,KAAMA,KACNqB,KAAMA,KACNK,QAAS,GACTJ,OAAQA,WAEZ,GACHX,MAAMgB,MACIC,mBAAUC,OAAO,iDAAkD,IACnEF,KACHG,YAAaR,WAGpBX,MAAK,CAACoB,KAAMC,MACTpB,MAAMqB,QAAQF,yBACJG,cAAcF,IAGxBG,kBAAkBnC,KAAMY,UAE3BwB,OAAOC,QACJC,QAAQD,MAAM,0BAA2BA,OACzCzB,MAAMqB,QAAQ,0GASbE,kBAAkBnC,KAAMY,aACvB2B,UAAY3B,MAAM4B,UAAU,GAG5BC,YAAcF,UAAUG,cAAc,uBACxCD,YAAa,KACTE,cACJF,YAAYjD,iBAAiB,SAAS,WAClCoD,aAAaD,eACbA,cAAgBE,YAAW,WACjBC,WAAaC,KAAKC,MAAMC,OAC9BnC,iBAAiBd,KAAM,EAAG8C,WAAYlC,SACvC,cAKLsC,YAAcX,UAAUG,cAAc,iBACxCQ,aACAA,YAAY1D,iBAAiB,SAAS,WAClCiD,YAAYO,MAAQ,GACpBlC,iBAAiBd,KAAM,EAAG,GAAIY,UAKtC2B,UAAU/C,iBAAiB,SAAS,SAASC,MACrCA,EAAEC,OAAOC,UAAUC,SAAS,uBAAwB,CACpDH,EAAEK,uBACIuB,KAAO8B,SAAS1D,EAAEC,OAAOO,aAAa,cACtC6C,WAAaL,YAAcA,YAAYO,MAAMC,OAAS,GAC5DnC,iBAAiBd,KAAMqB,KAAMyB,WAAYlC,WAKjD2B,UAAU/C,iBAAiB,SAAS,SAASC,MACrCA,EAAEC,OAAOC,UAAUC,SAAS,kBAAmB,CAC/CH,EAAEK,uBACIsD,QAAU3D,EAAEC,OAAO2D,YAAYJ,OACjCR,cACAA,YAAYO,MAAQI,QACpBtC,iBAAiBd,KAAM,EAAGoD,QAASxC,4CAMpC,CAACtB,KAAAA"}