define("local_datacurso_ratings/ratings_report_course",["exports","core/ajax","core/templates","core/notification","core/str"],(function(_exports,_ajax,_templates,_notification,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module ratings_report_course
   *
   * @module     local_datacurso_ratings/ratings_report_course
   * @copyright  2025 Industria Elearning <info@industriaelearning.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.default=void 0,_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification);const init=courseid=>{const container=document.querySelector("#ratings-report-container");container&&(!function(container){container.innerHTML='\n        <div class="text-center p-4">\n            <div class="spinner-border text-primary" role="status">\n                <span class="sr-only">Loading...</span>\n            </div>\n            <p class="mt-2">Cargando reporte de calificaciones...</p>\n        </div>\n    '}(container),_ajax.default.call([{methodname:"local_datacurso_ratings_get_ratings_report_course",args:{courseid:courseid}}])[0].then((data=>function(data,courseid){let totalLikes=0,totalDislikes=0,activitiesWithRatings=0;const processedActivities=data.map((activity=>(totalLikes+=activity.likes,totalDislikes+=activity.dislikes,activity.likes+activity.dislikes>0&&activitiesWithRatings++,{...activity,total_ratings:activity.likes+activity.dislikes,has_ratings:activity.likes+activity.dislikes>0,has_comments:activity.comentarios&&""!==activity.comentarios.trim(),satisfaction_class:getSatisfactionClass(activity.porcentaje),formatted_percentage:activity.porcentaje?activity.porcentaje.toFixed(1)+"%":"0%",activityurl:M.cfg.wwwroot+"/mod/"+activity.modulo+"/view.php?id="+activity.cmid}))),totalRatings=totalLikes+totalDislikes,overallSatisfaction=totalRatings>0?totalLikes/totalRatings*100:0;return{courseid:courseid,activities:processedActivities,has_data:processedActivities.length>0,summary:{total_activities:processedActivities.length,activities_with_ratings:activitiesWithRatings,total_ratings:totalRatings,total_likes:totalLikes,total_dislikes:totalDislikes,overall_satisfaction:overallSatisfaction.toFixed(1),satisfaction_class:getSatisfactionClass(overallSatisfaction)}}}(data,courseid))).then((templateData=>_templates.default.render("local_datacurso_ratings/report_ratings_course",templateData))).then(((html,js)=>{container.innerHTML=html,_templates.default.runTemplateJS(js),document.querySelectorAll(".expand-comments").forEach((button=>{button.addEventListener("click",(e=>{const target=e.target.getAttribute("data-target"),commentsDiv=document.querySelector(target);"none"!==commentsDiv.style.display&&commentsDiv.style.display?(commentsDiv.style.display="none",e.target.textContent="Ver comentarios"):(commentsDiv.style.display="block",e.target.textContent="Ocultar comentarios")}))})),document.querySelectorAll("th[data-sort]").forEach((header=>{header.style.cursor="pointer",header.addEventListener("click",(()=>{const sortBy=header.getAttribute("data-sort");var column;column=sortBy,console.log("Sorting by:",column)}))}))})).catch((error=>{console.error("Error loading ratings report:",error),function(container,error){container.innerHTML='\n        <div class="alert alert-danger">\n            <h4>Error al cargar el reporte</h4>\n            <p>No se pudo cargar la informaci√≥n del reporte. Por favor, intente nuevamente.</p>\n            <small>Error: '.concat(error.message||"Error desconocido","</small>\n        </div>\n    ")}(container,error)})))};function getSatisfactionClass(percentage){return percentage>=80?"success":percentage>=60?"warning":"danger"}_exports.init=init;var _default={init:init};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=ratings_report_course.min.js.map