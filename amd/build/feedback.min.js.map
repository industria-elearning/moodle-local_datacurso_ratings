{"version":3,"file":"feedback.min.js","sources":["../src/feedback.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module feedback\n *\n * @module     local_datacurso_ratings/feedback\n * @copyright  2025 Industria Elearning <info@industriaelearning.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n// This file is part of Moodle - http://moodle.org/\n//\n// @module     local_datacurso_ratings/feedback\n// @copyright  2025 Industria Elearning\n// @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n\n// This file is part of Moodle - http://moodle.org/\n//\n// @module     local_datacurso_ratings/feedback\n// @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n\nimport Ajax from \"core/ajax\";\nimport Notification from \"core/notification\";\n\n/**\n * Enviar nuevo feedback vía AJAX.\n *\n * @param {string} feedbacktext Texto del feedback que se va a agregar.\n * @returns {Promise<object>} Respuesta del servidor.\n */\nfunction addFeedback(feedbacktext) {\n    const requests = Ajax.call([{\n        methodname: \"local_datacurso_ratings_add_feedback\",\n        args: {feedbacktext}\n    }]);\n\n    return requests[0];\n}\n\n/**\n * Eliminar feedback vía AJAX.\n *\n * @param {number|string} id ID del feedback que se quiere eliminar.\n * @returns {Promise<object>} Respuesta del servidor.\n */\nfunction deleteFeedback(id) {\n    const requests = Ajax.call([{\n        methodname: \"local_datacurso_ratings_delete_feedback\",\n        args: {id}\n    }]);\n\n    return requests[0];\n}\n\n/**\n * Inicializar listeners en el panel admin.\n *\n * @returns {void}\n */\nexport function init() {\n    const form = document.querySelector(\".feedback-admin form\");\n    const list = document.querySelector(\".feedback-list\");\n\n    if (!form || !list) {\n        return;\n    }\n\n    // Agregar nuevo feedback\n    form.addEventListener(\"submit\", (e) => {\n        e.preventDefault();\n        const input = form.querySelector(\"input[name='feedbacktext']\");\n        if (!input.value.trim()) {\n            return;\n        }\n\n        addFeedback(input.value.trim())\n            .then((resp) => {\n                Notification.addNotification({ message: resp.message, type: \"success\" });\n\n                // Agregar dinámicamente a la lista\n                const li = document.createElement(\"li\");\n                li.className = \"feedback-item\";\n                li.innerHTML = `\n                    ${input.value}\n                    <button class=\"btn-delete\" data-id=\"${resp.id}\">✖️</button>\n                `;\n                list.prepend(li);\n                input.value = \"\";\n            })\n            .catch(Notification.exception);\n    });\n\n    // Eliminar feedback\n    list.addEventListener(\"click\", (e) => {\n        if (e.target.classList.contains(\"btn-delete\")) {\n            const id = e.target.dataset.id;\n\n            deleteFeedback(id)\n                .then((resp) => {\n                    Notification.addNotification({ message: resp.message, type: \"success\" });\n                    e.target.closest(\"li\").remove();\n                })\n                .catch(Notification.exception);\n        }\n    });\n}"],"names":["form","document","querySelector","list","addEventListener","e","preventDefault","input","feedbacktext","value","trim","Ajax","call","methodname","args","then","resp","addNotification","message","type","li","createElement","className","innerHTML","id","prepend","catch","Notification","exception","target","classList","contains","deleteFeedback","dataset","closest","remove"],"mappings":";;;;;;;;;;uFAyEUA,KAAOC,SAASC,cAAc,wBAC9BC,KAAOF,SAASC,cAAc,sBAE/BF,OAASG,YAKdH,KAAKI,iBAAiB,UAAWC,IAC7BA,EAAEC,uBACIC,MAAQP,KAAKE,cAAc,kCAxCpBM,aAyCRD,MAAME,MAAMC,SAzCJF,aA6CDD,MAAME,MAAMC,OA5CXC,cAAKC,KAAK,CAAC,CACxBC,WAAY,uCACZC,KAAM,CAACN,aAAAA,iBAGK,IAwCPO,MAAMC,6BACUC,gBAAgB,CAAEC,QAASF,KAAKE,QAASC,KAAM,kBAGtDC,GAAKnB,SAASoB,cAAc,MAClCD,GAAGE,UAAY,gBACfF,GAAGG,0CACGhB,MAAME,2EAC8BO,KAAKQ,sCAE/CrB,KAAKsB,QAAQL,IACbb,MAAME,MAAQ,MAEjBiB,MAAMC,sBAAaC,cAI5BzB,KAAKC,iBAAiB,SAAUC,OACxBA,EAAEwB,OAAOC,UAAUC,SAAS,cAAe,WAjD/BP,WACHb,cAAKC,KAAK,CAAC,CACxBC,WAAY,0CACZC,KAAM,CAACU,GAAAA,OAGK,IA8CRQ,CAFW3B,EAAEwB,OAAOI,QAAQT,IAGvBT,MAAMC,6BACUC,gBAAgB,CAAEC,QAASF,KAAKE,QAASC,KAAM,YAC5Dd,EAAEwB,OAAOK,QAAQ,MAAMC,YAE1BT,MAAMC,sBAAaC"}