{"version":3,"file":"feedback.min.js","sources":["../src/feedback.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Feedback module logic.\n *\n * @module     local_datacurso_ratings/feedback\n * @copyright  2025 Industria Elearning <info@industriaelearning.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\n\n/**\n * Send new feedback via AJAX.\n *\n * @param {string} feedbacktext Feedback text.\n * @param {string} type Feedback type (like/dislike).\n * @returns {Promise<object>} Server response.\n */\nfunction addFeedback(feedbacktext, type) {\n    const requests = Ajax.call([{\n        methodname: 'local_datacurso_ratings_add_feedback',\n        args: {feedbacktext, type}\n    }]);\n\n    return requests[0];\n}\n\n/**\n * Initialize feedback management.\n */\nexport function init() {\n    const container = document.querySelector('.feedback-admin');\n    if (!container) {\n        return;\n    }\n\n    const form = container.querySelector('form');\n    const list = container.querySelector('.feedback-list');\n    const type = container.dataset ? container.dataset.type : null;\n\n    if (!form || !list || !type) {\n        return;\n    }\n\n    // Add new feedback.\n    form.addEventListener('submit', (e) => {\n        e.preventDefault();\n        const input = form.querySelector(\"input[name='feedbacktext']\");\n        if (!input.value.trim()) {\n            return;\n        }\n\n        addFeedback(input.value.trim(), type)\n            .then((resp) => {\n                Notification.addNotification({\n                    message: resp.message,\n                    type: 'success'\n                });\n                const item = {\n                    id: resp.id,\n                    feedbacktext: input.value,\n                };\n                Templates.renderForPromise('local_datacurso_ratings/feedback_item', item)\n                    .then(({html, js}) => {\n                        Templates.runTemplateJS(js);\n                        const temp = document.createElement('div');\n                        temp.innerHTML = html.trim();\n                        const newItem = temp.firstChild;\n                        list.prepend(newItem);\n                    })\n                    .catch((err) => Notification.exception(err));\n                input.value = '';\n    })\n    .catch((err) => Notification.exception(err));\n\n    });\n\n    // Delete feedback.\n    list.addEventListener('click', (e) => {\n        if (e.target.classList.contains('btn-delete')) {\n            const id = e.target.dataset.id;\n\n            const requests = Ajax.call([{\n                methodname: 'local_datacurso_ratings_delete_feedback',\n                args: {id}\n            }]);\n\n            requests[0]\n                .then((resp) => {\n                    Notification.addNotification({\n                        message: resp.message,\n                        type: 'success'\n                    });\n                    e.target.closest('li').remove();\n                })\n                .catch((err) => Notification.exception(err));\n        }\n    });\n}\n"],"names":["container","document","querySelector","form","list","type","dataset","addEventListener","e","preventDefault","input","value","trim","feedbacktext","Ajax","call","methodname","args","addFeedback","then","resp","addNotification","message","item","id","renderForPromise","_ref","html","js","runTemplateJS","temp","createElement","innerHTML","newItem","firstChild","prepend","catch","err","Notification","exception","target","classList","contains","closest","remove"],"mappings":";;;;;;;4FA+CUA,UAAYC,SAASC,cAAc,uBACpCF,uBAICG,KAAOH,UAAUE,cAAc,QAC/BE,KAAOJ,UAAUE,cAAc,kBAC/BG,KAAOL,UAAUM,QAAUN,UAAUM,QAAQD,KAAO,SAErDF,OAASC,OAASC,YAKvBF,KAAKI,iBAAiB,UAAWC,IAC7BA,EAAEC,uBACIC,MAAQP,KAAKD,cAAc,8BAC5BQ,MAAMC,MAAMC,iBA9BJC,aAAcR,aACdS,cAAKC,KAAK,CAAC,CACxBC,WAAY,uCACZC,KAAM,CAACJ,aAAAA,aAAcR,KAAAA,SAGT,GA4BZa,CAAYR,MAAMC,MAAMC,OAAQP,MAC3Bc,MAAMC,6BACUC,gBAAgB,CACzBC,QAASF,KAAKE,QACdjB,KAAM,kBAEJkB,KAAO,CACTC,GAAIJ,KAAKI,GACTX,aAAcH,MAAMC,0BAEdc,iBAAiB,wCAAyCF,MAC/DJ,MAAKO,WAACC,KAACA,KAADC,GAAOA,4BACAC,cAAcD,UAClBE,KAAO7B,SAAS8B,cAAc,OACpCD,KAAKE,UAAYL,KAAKf,aAChBqB,QAAUH,KAAKI,WACrB9B,KAAK+B,QAAQF,YAEhBG,OAAOC,KAAQC,sBAAaC,UAAUF,OAC3C3B,MAAMC,MAAQ,MAEzByB,OAAOC,KAAQC,sBAAaC,UAAUF,UAKvCjC,KAAKG,iBAAiB,SAAUC,OACxBA,EAAEgC,OAAOC,UAAUC,SAAS,cAAe,OACrClB,GAAKhB,EAAEgC,OAAOlC,QAAQkB,GAEXV,cAAKC,KAAK,CAAC,CACxBC,WAAY,0CACZC,KAAM,CAACO,GAAAA,OAGF,GACJL,MAAMC,6BACUC,gBAAgB,CACzBC,QAASF,KAAKE,QACdjB,KAAM,YAEVG,EAAEgC,OAAOG,QAAQ,MAAMC,YAE1BR,OAAOC,KAAQC,sBAAaC,UAAUF"}