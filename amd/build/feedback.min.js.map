{"version":3,"file":"feedback.min.js","sources":["../src/feedback.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Feedback module logic.\n *\n * @module     local_datacurso_ratings/feedback\n * @copyright  2025 Industria Elearning <info@industriaelearning.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* eslint-disable */\nimport Ajax from \"core/ajax\";\nimport Notification from \"core/notification\";\n\n/**\n * Send new feedback via AJAX.\n *\n * @param {string} feedbacktext Feedback text.\n * @param {string} type Feedback type (like/dislike).\n * @returns {Promise<object>} Server response.\n */\nfunction addFeedback(feedbacktext, type) {\n    const requests = Ajax.call([{\n        methodname: \"local_datacurso_ratings_add_feedback\",\n        args: { feedbacktext, type }\n    }]);\n\n    return requests[0];\n}\n\nexport function init() {\n    const container = document.querySelector(\".feedback-admin\");\n    const form = container?.querySelector(\"form\");\n    const list = container?.querySelector(\".feedback-list\");\n    const type = container?.dataset.type;\n\n    if (!form || !list || !type) {\n        return;\n    }\n\n    // Add new feedback\n    form.addEventListener(\"submit\", (e) => {\n        e.preventDefault();\n        const input = form.querySelector(\"input[name='feedbacktext']\");\n        if (!input.value.trim()) {\n            return;\n        }\n\n        addFeedback(input.value.trim(), type)\n            .then((resp) => {\n                Notification.addNotification({ message: resp.message, type: \"success\" });\n\n                // Dynamically add the new feedback to the list\n                const li = document.createElement(\"li\");\n                li.className = \"feedback-item list-group-item d-flex justify-content-between align-items-center\";\n                li.innerHTML = `\n                    <span class=\"feedback-text\">${input.value}</span>\n                    <button type=\"button\" class=\"btn btn-outline-danger btn-sm btn-delete\" data-id=\"${resp.id}\">X</button>\n                `;\n                list.prepend(li);\n                input.value = \"\";\n            })\n            .catch(Notification.exception);\n    });\n\n    // Delete feedback\n    list.addEventListener(\"click\", (e) => {\n        if (e.target.classList.contains(\"btn-delete\")) {\n            const id = e.target.dataset.id;\n\n            const requests = Ajax.call([{\n                methodname: \"local_datacurso_ratings_delete_feedback\",\n                args: { id }\n            }]);\n\n            requests[0]\n                .then((resp) => {\n                    Notification.addNotification({ message: resp.message, type: \"success\" });\n                    e.target.closest(\"li\").remove();\n                })\n                .catch(Notification.exception);\n        }\n    });\n}\n"],"names":["container","document","querySelector","form","list","type","dataset","addEventListener","e","preventDefault","input","value","trim","feedbacktext","Ajax","call","methodname","args","addFeedback","then","resp","addNotification","message","li","createElement","className","innerHTML","id","prepend","catch","Notification","exception","target","classList","contains","closest","remove"],"mappings":";;;;;;;4FA4CUA,UAAYC,SAASC,cAAc,mBACnCC,KAAOH,MAAAA,iBAAAA,UAAWE,cAAc,QAChCE,KAAOJ,MAAAA,iBAAAA,UAAWE,cAAc,kBAChCG,KAAOL,MAAAA,iBAAAA,UAAWM,QAAQD,SAE3BF,OAASC,OAASC,YAKvBF,KAAKI,iBAAiB,UAAWC,IAC7BA,EAAEC,uBACIC,MAAQP,KAAKD,cAAc,8BAC5BQ,MAAMC,MAAMC,iBAvBJC,aAAcR,aACdS,cAAKC,KAAK,CAAC,CACxBC,WAAY,uCACZC,KAAM,CAAEJ,aAAAA,aAAcR,KAAAA,SAGV,GAqBZa,CAAYR,MAAMC,MAAMC,OAAQP,MAC3Bc,MAAMC,6BACUC,gBAAgB,CAAEC,QAASF,KAAKE,QAASjB,KAAM,kBAGtDkB,GAAKtB,SAASuB,cAAc,MAClCD,GAAGE,UAAY,kFACfF,GAAGG,sEAC+BhB,MAAMC,8HAC8CS,KAAKO,qCAE3FvB,KAAKwB,QAAQL,IACbb,MAAMC,MAAQ,MAEjBkB,MAAMC,sBAAaC,cAI5B3B,KAAKG,iBAAiB,SAAUC,OACxBA,EAAEwB,OAAOC,UAAUC,SAAS,cAAe,OACrCP,GAAKnB,EAAEwB,OAAO1B,QAAQqB,GAEXb,cAAKC,KAAK,CAAC,CACxBC,WAAY,0CACZC,KAAM,CAAEU,GAAAA,OAGH,GACJR,MAAMC,6BACUC,gBAAgB,CAAEC,QAASF,KAAKE,QAASjB,KAAM,YAC5DG,EAAEwB,OAAOG,QAAQ,MAAMC,YAE1BP,MAAMC,sBAAaC"}